<% provide(:title, 'Order_show') %>
<ul class="order-image">
</ul>
<%= form_with(model: @order, url: user_orders_path(@user), local: true) do |f| %>
<section class="section">
  <div class="container">
      <h1 class="title has-text-centered">
        指示書詳細
      </h1>
    <div class="columns is-centered">
      <div class="column is-10">
         <div class="table-container">
           <%= render partial: 'shared/error_messages', locals: { obj: @order } %>
           <div class="field is-grouped">
             <div class="control">
               <font color="#FF6666"><i class="fas fa-tooth"></i></font>
             </div>
             <div class="control">
               <font color="red"><p class="warning-text is-size-7">マークは【必須】になります。</p></font>
             </div>
           </div> 
           <table class="table is-bordered is-hoverable is-fullwidth" id="order-table">
             <tr>
               <th>技工所名</th>
               <td colspan = "5">
                 <div class="has-text-weight-semibold is-size-5">デンタルラボラトリー</div>
               </td>
             </tr>
             <tr>
               <th>医院名</th>
               <td colspan = "5">
                 <div class="has-text-weight-semibold is-size-5"><%= current_user.name %>&ensp;様</div>
               </td>
             </tr>
             <tr>
               <th class="select-table">
                 患者名
               </th>
               <td colspan = "3">
                 <div class="has-text-weight-semibold is-size-5"><%= @order.patient_name %>&ensp;様</div>   
               </td>
               <th class="select-table">
                 性別
               </th>
               <td class="select-table">
                 <div class="has-text-weight-normal is-size-5"><%= @order.sex %></div>
               </td>
             </tr>
             <tr>
               <th class="select-tag">
                 受付日
               </th>
               <td class="select-date">
                 <div class="has-text-weight-normal is-size-6"><%= l(@order.reception_date, format: :long) %></div>
               </td>
               <th class="select-tag">シェード</th>
               <td class="select-order">
                 <div class="has-text-weight-normal is-size-6"><%= @order.color %></div>  
               </td>
               <th class="select-tag">
                 単 or 連
               </th>
               <td class="select-order">
                 <div class="has-text-weight-normal is-size-6"><%= @order.crown %></div> 
               </td>
             </tr>
             <tr>
               <th colspan = "6">
                 部位 ・注意事項
               </th>
             </tr>
             <tr>
               <td colspan = "6">
                 <div class="has-text-weight-normal is-size-6"><%= @order.note %></div>
               </td>
             </tr>
             <tr>
               <th colspan = "6">
                 注文内容
               </th>
             </tr>
             <tr>
               <td colspan = "6">
                 <div class="field is-grouped">
                   <div class="control">
                      <div class="has-text-weight-normal is-size-6"><%= @order.content %></div>     
                   </div>
                   <div class="control">
                     <div class="has-text-weight-normal is-size-6"><%= @order.other_text %></div>
                   </div>
                 </div>
               </td>
             </tr>
             <tr>
               <th class="select-metal">使用金属</th>
               <td>
                 <div class="has-text-weight-normal is-size-6"><%= @order.metal %></div>
               </td>
               <th class="select-metal">
                 <font color="#FF6666"><i class="fas fa-tooth"></i></font>&nbsp;金属量
               </th>
               <td>
                 <%= f.number_field :weight, step: '0.1', min: "0.0", :placeholder => "g", class: "input is-info is-small" %>
               </td>
               <td colspan = "2"></td>
             </tr>
             <tr>
               <th colspan = "6">口腔内写真</th>
             </tr>
             <tr>
               <td colspan = "2">
                 <div class="field tooth-image has-text-centered show-modal" data-target="modalA">
                    <% if @order.image_1.present? %>
                      <%= image_tag @order.image_1.thumb.url, size: "250x250" %>
                    <% else %>
                      <%= image_tag "/user_images/no-image-2.png", size: "250x250" %>
                    <% end %>
                  </div>
               </td>
               <td colspan = "2">
                 <div class="field tooth-image has-text-centered show-modal-2" data-target="modalB">
                    <% if @order.image_2.present? %>
                      <%= image_tag @order.image_2.thumb.url, size: "250x250" %>
                    <% else %>
                      <%= image_tag "/user_images/no-image-2.png", size: "250x250" %>
                    <% end %>
                  </div>
               </td>
               <td colspan = "2">
                 <div class="field tooth-image has-text-centered" id="open-3">
                    <% if @order.image_3.present? %>
                      <%= image_tag @order.image_3.thumb.url, size: "250x250" %>
                    <% else %>
                      <%= image_tag "/user_images/no-image-2.png", size: "250x250" %>
                    <% end %>
                  </div>
               </td>
             </tr>
             <tr>
               <th class="select-tag"><font color="#FF6666"><i class="fas fa-calendar-check"></i></font>&nbsp;試適１</th>
               <td class="select-date">
                 <%= f.datetime_field :first_try, class: "input is-small is-info" %>
               </td>
               <th class="select-tag"><font color="#FF6666"><i class="fas fa-calendar-check"></i></font>&nbsp;試適２</th>
               <td class="select-date">
                <%= f.datetime_field :second_try, class: "input is-small is-info" %>  
               </td>
               <th class="select-tag"><font color="#FF6666"><i class="fas fa-calendar-check"></i></font>&nbsp;完成日</th>
               <td class="select-date">
                <%= f.datetime_field :complete_day, class: "input is-small is-info" %>  
               </td>
             </tr>
           </table>
          </div>
          <div class="has-text-centered">
            <%= f.submit "指示書作成", class: "button is-warning is-medium" %>&emsp;&nbsp;
            <%= link_to "キャンセル", '#', class: "button is-outlined is-medium" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<% end %>

<div class="modal" id="modalA">
  <div class="modal-background">
    <button class="delete is-large" aria-label="close" data-target="show-modal"></button>
  </div>
    <div class="modal-content">
      <p class="images-orders is-4by3">
          <% if @order.image_1.present? %>
            <%= image_tag @order.image_1.thumb.url %>
          <% else %>
            <%= image_tag "/user_images/no-image-2.png" %>
          <% end %>
      </p>
    </div>
</div>


<script>
  for (const element of document.querySelectorAll('.modal .delete, .show-modal')) {
    element.addEventListener('click', e => {
      const modalId = element.dataset.target;
      const modal = document.getElementById(modalId);
      modal.classList.toggle('is-active');
    });
  }
</script>

<div class="modal" id="modalB">
  <div class="modal-background">
    <button class="delete is-large" aria-label="close" data-target="show-modal-2"></button>
  </div>
    <div class="modal-content">
      <p class="images-orders is-4by3">
          <% if @order.image_2.present? %>
            <%= image_tag @order.image_2.thumb.url %>
          <% else %>
            <%= image_tag "/user_images/no-image-2.png" %>
          <% end %>
      </p>
    </div>
</div>



<script>
  for (const element of document.querySelectorAll('.modal .delete, .show-modal-2')) {
    element.addEventListener('click', e => {
      const modalId = element.dataset.target;
      const modal = document.getElementById(modalId);
      modal.classList.toggle('is-active');
    });
  }
</script>

<script>
  $(document).ready(function() {
    $("#open_3").on("click", function() {
      $("div.modal").addClass("is-active");
    })

    $("#close, div.modal-background").on("click", function() {
      $("div.modal").removeClass("is-active");
    })
  });
</script>
    
    